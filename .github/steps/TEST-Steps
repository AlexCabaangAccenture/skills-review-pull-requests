
Change request for Vendor PO:

As Is:

· Currently the PO with Parts Item is created in DBS thru Part order process while for Non Parts it is created in Yancey PO system.

· PO # with longer number values (ex. PO#:S0930902004) is created in the Yancey PO system while the shorter number (ex. PO#:100919) and with DBS import tagging is created in DBS.

· When a new PO is created or updated in DBS, the header information is recorded or updated in the POPHEAD0 table within the FDCSPOLIBP library, while the line item details are written to the POPDETL0 table in the same library. A SQL Server job runs every 5 minutes, extracting new purchase orders and saving the data into the corresponding SQL tables (PurchaseOrderHeader and PurchaseOrderDetail). This data is then imported into the Yancey PO system.

· Each hour there is a sql job that reads the parts audit file (PCPARDB0) for parts received, updates the received qty for that item in the corresponding Purchase Order and adds a note that the item was received with date and qty received in the Yancey PO system.

· Each night there is a sql job that reads payment information from financials (Coda) and updates the corresponding Purchase Order when it has been paid. It adds a note with payment date and amt in Yancey PO system.

· Purchase orders for stock parts are created in DBS (Back order to Caterpillar), but do not go through the PO system.


To Be:

· The Yancey PO system will be replaced by the PO functionality in D365.

· Purchase Orders created, updated and deleted in DBS will be sent to D365, utilizing reference files POPHEAD0 and POPDETL0 to map PO details. For the delete process, the Delete P.O Indicator is set to “Y” if the PO is for deletion.

· Information on parts received, which reads from the Parts audit file PCPARDB0, will be sent from DBS to D365. This will update the date and received quantity for the corresponding item in the Purchase Order.

· The vendor payment process will be managed within D365 F&O.

· Purchase orders for stock parts are created in DBS (Back order to Caterpillar) should be sent to D365. These are the reference files Libd50.PCPSRPD0 = order detail and libd50.pcpsron0 = order header




Reference:

When a new PO is created in DBS the header information is written to POPHEAD0 in library FDCSPOLIBP. The line item information is written to POPDETL0 in library FDCSPOLIBP. We have a sql server job that runs every 5 minutes and pulls in new purchase orders and stores the data in the appropriate sql tables (PurchaseOrderHeader, PurchaseOrderDetail).

The statement below is an example of selecting the active header records created in the last 5 days that do not already exist in the purchase order .net application.

SELECT h.HDNUMB, h.HDJOB, h.HDUSR, h.HDNBR, h.HDDTMM, h.HDDTDD, h.HDDTYY, h.HDDELT, h.HDVNUM, h.HDVNAM, h.HDADR2, h.HDADR3, h.HDADR4, h.HDPHON, h.HDFAX#, h.HDCNTC, h.HDSKEY, h.HDPRNT, h.HDCNTR, h.HDSRNO, h.HDSTNO, h.HDGTOT, h.HDSTAT, h.HDDOCU, h.HDSHIP, h.HDSHP1, h.HDSHP2, h.HDSHP3, h.HDATTN, h.HDPCDE, h.HDTERM, h.HDNOT1, h.HDPRT1, h.HDNOT2, h.HDPRT2, h.HDNOT3, h.HDPRT3, h.HDNOT4, h.HDPRT4, h.HDNOT5, h.HDPRT5, h.HDCUST, h.HDEXPD, h.HDSYST, h.HDDCPO, h.HDLSQN, h.HDTAXO, h.HDPYMT, h.HDPDT8, h.HDCH1, h.HDCH2, h.HDCH3, h.HDCH4, h.HDCH5, h.HDNU6, h.HDNU7, h.HDNU8, h.HDNU9, h.HDNU10, h.HDCUR, h.HDLMD8, h.HDLMDT, h.HDLUSR, h.HDCMD8, h.HDCMDT, h.HDCUSR, h.HDCHKN, h.HDCHKD, h.HDEMAL, h.HDORID, h.HDAUTB, h.HDAUTD

FROM dbo.PurchaseOrderHeader AS p RIGHT OUTER JOIN

(SELECT HDNUMB, HDJOB, HDUSR, HDNBR, HDDTMM, HDDTDD, HDDTYY, HDDELT, HDVNUM, HDVNAM, HDADR2, HDADR3, HDADR4, HDPHON, HDFAX#, HDCNTC, HDSKEY, HDPRNT, HDCNTR, HDSRNO, HDSTNO, HDGTOT, HDSTAT, HDDOCU, HDSHIP, HDSHP1, HDSHP2, HDSHP3, HDATTN, HDPCDE, HDTERM, HDNOT1, HDPRT1, HDNOT2, HDPRT2, HDNOT3, HDPRT3, HDNOT4, HDPRT4, HDNOT5, HDPRT5, HDCUST, HDEXPD, HDSYST, HDDCPO, HDLSQN, HDTAXO, HDPYMT, HDPDT8, HDCH1, HDCH2, HDCH3, HDCH4, HDCH5, HDNU6, HDNU7, HDNU8, HDNU9, HDNU10, HDCUR, HDLMD8, HDLMDT, HDLUSR, HDCMD8, HDCMDT, HDCUSR, HDCHKN, HDCHKD, HDEMAL, HDORID, HDAUTB, HDAUTD, RRN, ImportDate

FROM FDCSPOLIBP.POPHEAD0

WHERE (HDDELT IN ('N', '')) AND (CONVERT(nvarchar, HDCMD8, 112) >= CONVERT(nvarchar, CAST(DATEADD(day, - 5, GETDATE()) AS datetime2), 112))) AS h

ON p.PurchaseOrderID = CAST(h.HDNUMB AS nvarchar)

WHERE (p.PurchaseOrderID IS NULL)

For the new pos that need to be inserted get the detail for each from POPDETL0 in library FDCSPOLIBP.
